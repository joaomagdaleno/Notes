name: Automated Maintenance
on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 1 * *' # Monthly

permissions:
  contents: write
  pull-requests: write

jobs:
  maintenance:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      
      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.38.2'
          cache: true

      - name: Run Cleanup
        working-directory: Notes-Hub
        run: |
          flutter pub cache clean --force
          flutter pub get
          dart fix --apply
          flutter pub upgrade

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore(maintenance): automated dependency upgrade and dart fix"
          title: "ðŸ§¹ Monthly Maintenance Cleanup"
          body: |
            Automated maintenance run:
            - Applied `dart fix`
            - Upgraded dependencies via `flutter pub upgrade`
            - Verified project health
          branch: maintenance/cleanup
          delete-branch: true
